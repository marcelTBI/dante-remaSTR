<!DOCTYPE html>
<html lang="en">
<head>
    <title>Population report</title>
    <meta charset="UTF-8" />
    <script src="./includes/plotly-2.14.0.min.js"></script>
    <script src="./includes/jquery-3.6.1.min.js"></script>
    <script src="./includes/datatables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./includes/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="./includes/w3.css">
    <link rel="stylesheet" type="text/css" href="./includes/styles.css">
</head>

<body>
<h1>ALS</h1>
<div>
Sequence:
{{ data["sequence"][0] }}
{% for module in data["sequence"][1:-1] %} <a href="TODO">{{ module }}</a> {% endfor %}
{{ data["sequence"][-1] }}

<table class="tg" id="main_table" width="100%">
    <thead>
        <tr>
            <th rowspan="2">Sample</th>
            <th colspan="{{ data['sequence'][1:-1]|length }}">Nomenclature_1</th>
            <th rowspan="2">Warnings_1</th>
            <th colspan="{{ data['sequence'][1:-1]|length }}">Nomenclature_2</th>
            <th rowspan="2">Warnings_2</th>
        </tr>
        <tr>
            {% for _ in data["sequence"][1:-1] %} <th>part{{ loop.index }}</th> {% endfor %}
            {% for _ in data["sequence"][1:-1] %} <th>part{{ loop.index }}</th> {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in data["main_table"] %}
        <tr>
            <td>{{ row["sample"] }}</td>
            {% for x in row["nomenclature1"] %} <td>{{ x }}</td> {% endfor %}
            <td>{% for x in row["warnings1"] %} {{ x }}<br> {% endfor %}</td>
            {% for x in row["nomenclature2"] %} <td>{{ x }}</td> {% endfor %}
            <td>{% for x in row["warnings2"] %} {{ x }}<br> {% endfor %}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
$(document).ready( function() {
    $('#main_table').DataTable({scrollX: true});
} );
</script>

<div id="histogram" style="width: 950px; margin: auto;"></div>
<script>
{
    let title = "Histogram";
    let destination = "histogram"

    // let tickvals = [0, 1, 2];
    // let x = [2, 4, 5];
    // let ticktext = ["tmp", "tmp2", "tmp3"];

    let tickvals = {{ data["main_histogram"]["tickvals"] }};
    let x = {{ data["main_histogram"]["x"] }};
    let ticktext = {{ data["main_histogram"]["ticktext"] }};

    let hist_data = {
        "data":[{
            "x": x,
            "name":"Motif",
            "marker":{"color":"#636EFA"},
            "textfont":{"color":"#636EFA","size":7},
            "type":"bar",
            "orientation": "h",
            "hover":"true"
        }],
        "layout":{
            "title":{"text": title},
            "yaxis":{
                "title":{"text":"Prediction"},
                "tickmode":"array",
                "tickvals": tickvals,
                "ticktext": ticktext,
                "automargin": true
            },
            "xaxis": {"fixedrange":true,"title":{"text":"Count"}},
            "legend": {"x": 0.85, "y": 0.85 },
            "barmode":"stack",
            "hovermode":"y",
            "height": 180 + 30 * x.length
        }
    };

    Plotly.newPlot(destination, hist_data);
}
</script>

<div id="heatmap" style="width: 950px; margin: auto;"></div>
<script>
{
    // let z = [
    //   [null, 0   , 35  , 119 , 3   ],
    //   [null, null, 0   , 237 , 3   ],
    //   [null, null, null, 0   , 2   ],
    //   [null, null, null, null, 0   ],
    //   [null, null, null, null, null]
    // ];
    // let tickvals = [0, 1, 2, 3, 4, 5];
    // let ticktext = ['CGG[7]', 'CGG[3]CTG[1]CGG[4]', 'CGG[5]TGG[1]CGG[2]', 'CGG[8]', 'CTG[1]CGG[7]'];

    let z = {{ data["main_heatmap"]["z"]|replace("None", "null") }}
    let ticktext = {{ data["main_heatmap"]["ticktext"] }};
    let tickvals = {{ data["main_heatmap"]["tickvals"] }};

    let heatmap_data = {
        "data": [{
            "z": z,
            "text": z,
            "name": "Prediction heatmap",
            "colorscale": [
                [0.0, "rgb(255, 255, 255)"], [0.01, "rgb(255, 210, 0)"], [0.1, "rgb(255, 140, 0)"],
                [0.4, "rgb(255, 70, 0)"], [0.7, "rgb(230, 0  , 0)"], [1.0, "rgb(100, 0  , 0)"]
            ],
            "hovertemplate":"Allele 2: %{x}<br>Allele 1: %{y}<br>Count: %{z}",
            "texttemplate": "%{text}",
            "type": "heatmap"
        }],
        "layout": {
            "title":{"text": "Heatmap"},
            "xaxis": {
                "tickvals": tickvals,
                "ticktext": ticktext,
                "title": { "text": "Allele 2" }, "showgrid": false, "showline": false, "zeroline": false,
                "automargin": true,
                "tickangle": -90,
            },
            "yaxis": {
                "tickvals": tickvals,
                "ticktext": ticktext,
                "title": { "text": "Allele 1" }, "showgrid": false, "showline": false, "zeroline": false,
                "scaleanchor": "x",
                "automargin": true,
            },
            "width": 950,
            "height": 950,
        },
    };
    Plotly.newPlot('heatmap', heatmap_data);
}

</script>

</div>

</body>
</html>
